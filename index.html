<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 30px;
            background: #f9f9fb;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-top: 20px;
            font-weight: 600;
            color: #34495e;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
        }
        button {
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: background 0.3s;
        }
        button:hover {
            background: #2980b9;
        }
        .team {
            margin-top: 20px;
            padding: 16px;
            background: #e3f2fd;
            border-left: 5px solid #2196f3;
            border-radius: 0 6px 6px 0;
        }
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
            margin-top: 15px;
            display: none;
        }
        .info-box {
            background: #f1f8e9;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.95em;
            color: #2e7d32;
        }
        .subject-title {
            color: #2c3e50;
            font-weight: bold;
        }
        #results { margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéì –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã</h1>

        <form id="teamForm">
            <label for="subject">üìö –ü—Ä–µ–¥–º–µ—Ç:</label>
            <select id="subject" name="subject" required>
                <option value="geo">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</option>
            </select>

            <label for="teams_count">üî¢ –ß–∏—Å–ª–æ –∫–æ–º–∞–Ω–¥:</label>
            <input type="number" id="teams_count" name="teams_count" value="3" min="1" required>

            <label for="absent">‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
            <input type="text" id="absent" name="absent"
                   placeholder="–ü—Ä–∏–º–µ—Ä: –ê –ê–ª–µ–∫—Å–µ–π –ê, –í –ú–∏—Ä—Ä–∞ –ü">

            <div class="info-box" id="peopleInfo">
                <span class="subject-title">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è:</span>
                –ê –ê–ª—å—Ñ–∏–Ω–∞ –ê., –ê –ú–∏–ª–∞–Ω–∞ –ê, –ê –ï–≤–∞ –≠, –ê –ê–ª–µ–∫—Å–µ–π –ê, –ë –î–º–∏—Ç—Ä–∏–π –î, –í –ú–∏—Ä—Ä–∞ –ü, –ì –Ø—Ä–æ—Å–ª–∞–≤ –û, –ì –ö—Å–µ–Ω–∏—è –ê, –î –ò–≤–∞–Ω –î, –î –ù–∞–¥–µ–∂–¥–∞ –ò, –ñ –õ–∞–≤—Ä–µ–Ω—Ç–∏–π –ê, –ó –í–∞–ª–µ—Ä–∏—è –ê, –ö –ê–Ω–¥—Ä–µ–π –ù, –§–∏–ª–∏–ø –û. –ö, –ö –Ø—Ä–æ—Å–ª–∞–≤ –î, –ü –î–∞—Ä—å—è –ò, –ú –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°, –û –ü–∞–≤–µ–ª –ò, –° –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –Æ, –° –î–∞–Ω–∏–∏–ª –°, –° –†–æ–º–∞–Ω –°, –° –§–µ–¥–æ—Ä –ú, –Æ –î–∞—Ä—å—è –ò, –Ø –ú–∞—Ç–≤–µ–π –í
            </div>

            <button type="submit">–†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã</button>
        </form>

        <div id="error" class="error"></div>
        <div id="results"></div>
    </div>

    <script>
        // === –î–∞–Ω–Ω—ã–µ ===
        const FIXED_PAIR = ['–ì –Ø—Ä–æ—Å–ª–∞–≤ –û', '–ì –ö—Å–µ–Ω–∏—è –ê'];

        const SUBJECTS_DATA = {
            geo: {
                name: '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è',
                people: [
                    '–ê –ê–ª—å—Ñ–∏–Ω–∞ –ê.', '–ê –ú–∏–ª–∞–Ω–∞ –ê', '–ê –ï–≤–∞ –≠', '–ê –ê–ª–µ–∫—Å–µ–π –ê', '–ë –î–º–∏—Ç—Ä–∏–π –î',
                    '–í –ú–∏—Ä—Ä–∞ –ü', '–ì –Ø—Ä–æ—Å–ª–∞–≤ –û', '–ì –ö—Å–µ–Ω–∏—è –ê', '–î –ò–≤–∞–Ω –î', '–î –ù–∞–¥–µ–∂–¥–∞ –ò',
                    '–ñ –õ–∞–≤—Ä–µ–Ω—Ç–∏–π –ê', '–ó –í–∞–ª–µ—Ä–∏—è –ê', '–ö –ê–Ω–¥—Ä–µ–π –ù', '–§–∏–ª–∏–ø –û. –ö', '–ö –Ø—Ä–æ—Å–ª–∞–≤ –î',
                    '–ü –î–∞—Ä—å—è –ò', '–ú –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°', '–û –ü–∞–≤–µ–ª –ò', '–° –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –Æ', '–° –î–∞–Ω–∏–∏–ª –°',
                    '–° –†–æ–º–∞–Ω –°', '–° –§–µ–¥–æ—Ä –ú', '–Æ –î–∞—Ä—å—è –ò', '–Ø –ú–∞—Ç–≤–µ–π –í'
                ],
                fixedPairs: [FIXED_PAIR]
            }
        };

        // === –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ===
        function shuffle(array) {
            // –ö–æ–ø–∏—Ä—É–µ–º –º–∞—Å—Å–∏–≤, —á—Ç–æ–±—ã –Ω–µ –º—É—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function divideIntoTeamsWithPairs(people, teamsCount, fixedPairs) {
            const peopleSet = new Set(people);
            const teams = Array.from({ length: teamsCount }, () => []);
            const remaining = [...people];

            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ä
            for (const pair of fixedPairs) {
                const [a, b] = pair;
                if (peopleSet.has(a) && peopleSet.has(b)) {
                    // –ù–∞—Ö–æ–¥–∏–º –∫–æ–º–∞–Ω–¥—É —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –¥–ª–∏–Ω–æ–π
                    const minTeamIdx = teams.reduce((minIdx, team, idx) =>
                        team.length < teams[minIdx].length ? idx : minIdx, 0);
                    teams[minTeamIdx].push(a, b);
                    // –£–¥–∞–ª—è–µ–º –∏–∑ remaining
                    const aIndex = remaining.indexOf(a);
                    const bIndex = remaining.indexOf(b);
                    if (aIndex !== -1) remaining.splice(aIndex, 1);
                    if (bIndex !== -1) remaining.splice(bIndex - (aIndex < bIndex ? 1 : 0), 1);
                }
            }

            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ
            const shuffledRemaining = shuffle(remaining);
            shuffledRemaining.forEach(person => {
                const minTeamIdx = teams.reduce((minIdx, team, idx) =>
                    team.length < teams[minIdx].length ? idx : minIdx, 0);
                teams[minTeamIdx].push(person);
            });

            return teams;
        }

        // === –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ ===
        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = `‚ö†Ô∏è –û—à–∏–±–∫–∞: ${message}`;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function renderTeams(teams, subjectName) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h2>‚úÖ –ö–æ–º–∞–Ω–¥—ã –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É: <em>${subjectName}</em></h2>
                ${teams.map((team, i) => `
                    <div class="team">
                        <strong>üîπ –ö–æ–º–∞–Ω–¥–∞ ${i + 1} (${team.length}):</strong><br>
                        ${team.join(', ')}
                    </div>
                `).join('')}
            `;
        }

        function updatePeopleInfo() {
            const subjectKey = document.getElementById('subject').value;
            const subject = SUBJECTS_DATA[subjectKey];
            const infoBox = document.getElementById('peopleInfo');
            infoBox.innerHTML = `
                <span class="subject-title">${subject.name}:</span>
                ${subject.people.join(', ')}
            `;
        }

        document.getElementById('subject').addEventListener('change', updatePeopleInfo);

        document.getElementById('teamForm').addEventListener('submit', function(e) {
            e.preventDefault();
            hideError();

            const subjectKey = document.getElementById('subject').value;
            let teamsCount = parseInt(document.getElementById('teams_count').value);
            const absentInput = document.getElementById('absent').value.trim();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (isNaN(teamsCount) || teamsCount < 1) {
                showError('–ß–∏—Å–ª–æ –∫–æ–º–∞–Ω–¥ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ü–µ–ª—ã–º ‚â• 1');
                return;
            }

            const subject = SUBJECTS_DATA[subjectKey];
            if (!subject) {
                showError('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç');
                return;
            }

            const allPeople = subject.people;
            const absentList = absentInput ?
                absentInput.split(',').map(s => s.trim()).filter(s => s) : [];

            const available = allPeople.filter(p => !absentList.includes(p));

            if (available.length === 0) {
                showError('–ù–µ–∫–æ–≥–æ –¥–µ–ª–∏—Ç—å ‚Äî –≤—Å–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.');
                return;
            }

            if (teamsCount > available.length) {
                showError(`–ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å ${teamsCount} –∫–æ–º–∞–Ω–¥ –∏–∑ ${available.length} —á–µ–ª–æ–≤–µ–∫.`);
                return;
            }

            try {
                const teams = divideIntoTeamsWithPairs(available, teamsCount, subject.fixedPairs);
                renderTeams(teams, subject.name);
            } catch (err) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥: ' + err.message);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ñ–æ—Ä–º–∞ —É–∂–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞)
        updatePeopleInfo();
    </script>
</body>
</html>