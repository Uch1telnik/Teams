<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéì –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã</title>
    <style>
        :root {
            /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ ‚Äî –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            --bg-body: #f9f9fb;
            --bg-container: #ffffff;
            --text-primary: #2c3e50;
            --text-secondary: #34495e;
            --border-color: #ddd;
            --shadow: 0 4px 12px rgba(0,0,0,0.08);
            --btn-bg: #3498db;
            --btn-hover: #2980b9;
            --team-bg: #e3f2fd;
            --team-border: #2196f3;
            --error-bg: #fdf2f2;
            --error-border: #e74c3c;
            --error-text: #e74c3c;
            --info-bg: #f1f8e9;
            --info-text: #2e7d32;
            --select-bg: #ffffff;
        }

        .dark-theme {
            /* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
            --bg-body: #121212;
            --bg-container: #1e1e1e;
            --text-primary: #f0f0f0;
            --text-secondary: #e0e0e0;
            --border-color: #444;
            --shadow: 0 4px 12px rgba(0,0,0,0.3);
            --btn-bg: #1e88e5;
            --btn-hover: #1565c0;
            --team-bg: #1e3a5f;
            --team-border: #4fc3f7;
            --error-bg: #3d2323;
            --error-border: #c62828;
            --error-text: #ef9a9a;
            --info-bg: #2e3b2a;
            --info-text: #a5d6a7;
            --select-bg: #2d2d2d;
        }

        * {
            transition: background-color 0.3s, color 0.3s, border-color 0.3s, box-shadow 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 30px 20px;
            background-color: var(--bg-body);
            color: var(--text-primary);
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--bg-container);
            padding: 25px;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        h1 {
            text-align: center;
            color: var(--text-primary);
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-top: 20px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            margin-top: 8px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            background-color: var(--select-bg);
            color: var(--text-primary);
        }

        input::placeholder {
            color: #aaa;
        }

        button {
            background: var(--btn-bg);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin-top: 20px;
            transition: background 0.3s;
        }

        button:hover {
            background: var(--btn-hover);
        }

        .team {
            margin-top: 20px;
            padding: 16px;
            background: var(--team-bg);
            border-left: 5px solid var(--team-border);
            border-radius: 0 6px 6px 0;
            color: var(--text-primary);
        }

        .error {
            color: var(--error-text);
            background: var(--error-bg);
            padding: 12px;
            border-radius: 6px;
            border-left: 4px solid var(--error-border);
            margin-top: 15px;
            display: none;
        }

        .info-box {
            background: var(--info-bg);
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.95em;
            color: var(--info-text);
        }

        .subject-title {
            color: var(--text-primary);
            font-weight: bold;
        }

        #results {
            margin-top: 30px;
        }

        /* –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã */
        .theme-toggle {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: rgba(128, 128, 128, 0.1);
            color: var(--text-primary);
        }

        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã -->
    <button id="themeToggle" class="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        üåû
    </button>

    <div class="container">
        <h1>üéì –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–ª–∞—Å—Å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã</h1>

        <form id="teamForm">
            <label for="subject">üìö –ü—Ä–µ–¥–º–µ—Ç:</label>
            <select id="subject" name="subject" required>
                <option value="geo">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</option>
            </select>

            <label for="teams_count">üî¢ –ß–∏—Å–ª–æ –∫–æ–º–∞–Ω–¥:</label>
            <input type="number" id="teams_count" name="teams_count" value="3" min="1" required>

            <label for="absent">‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é):</label>
            <input type="text" id="absent" name="absent"
                   placeholder="–ü—Ä–∏–º–µ—Ä: –ê –ê–ª–µ–∫—Å–µ–π –ê, –í –ú–∏—Ä—Ä–∞ –ü">

            <div class="info-box" id="peopleInfo">
                <span class="subject-title">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è:</span>
                –ê –ê–ª—å—Ñ–∏–Ω–∞ –ê., –ê –ú–∏–ª–∞–Ω–∞ –ê, –ê –ï–≤–∞ –≠, –ê –ê–ª–µ–∫—Å–µ–π –ê, –ë –î–º–∏—Ç—Ä–∏–π –î, –í –ú–∏—Ä—Ä–∞ –ü, –ì –Ø—Ä–æ—Å–ª–∞–≤ –û, –ì –ö—Å–µ–Ω–∏—è –ê, –î –ò–≤–∞–Ω –î, –î –ù–∞–¥–µ–∂–¥–∞ –ò, –ñ –õ–∞–≤—Ä–µ–Ω—Ç–∏–π –ê, –ó –í–∞–ª–µ—Ä–∏—è –ê, –ö –ê–Ω–¥—Ä–µ–π –ù, –§–∏–ª–∏–ø –û. –ö, –ö –Ø—Ä–æ—Å–ª–∞–≤ –î, –ü –î–∞—Ä—å—è –ò, –ú –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°, –û –ü–∞–≤–µ–ª –ò, –° –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –Æ, –° –î–∞–Ω–∏–∏–ª –°, –° –†–æ–º–∞–Ω –°, –° –§–µ–¥–æ—Ä –ú, –Æ –î–∞—Ä—å—è –ò, –Ø –ú–∞—Ç–≤–µ–π –í
            </div>

            <button type="submit">–†–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –∫–æ–º–∞–Ω–¥—ã</button>
        </form>

        <div id="error" class="error"></div>
        <div id="results"></div>
    </div>

    <script>
        // === –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ–º—ã ===
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏—Å—Ç–µ–º–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É
        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        // –ò–ª–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
        const savedTheme = localStorage.getItem('theme');
        let currentTheme = savedTheme || (prefersDark ? 'dark' : 'light');

        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
        function applyTheme(theme) {
            if (theme === 'dark') {
                body.classList.add('dark-theme');
                themeToggle.textContent = 'üåô';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.remove('dark-theme');
                themeToggle.textContent = 'üåû';
                localStorage.setItem('theme', 'light');
            }
        }

        applyTheme(currentTheme);

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É
        themeToggle.addEventListener('click', () => {
            currentTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(currentTheme);
        });

        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–π —Ç–µ–º—ã (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏)
        if (window.matchMedia) {
            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
                if (!localStorage.getItem('theme')) { // —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–¥–∞–ª –≤—Ä—É—á–Ω—É—é
                    applyTheme(e.matches ? 'dark' : 'light');
                }
            });
        }

        // === –õ–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ===
        const FIXED_PAIR = ['–ì –Ø—Ä–æ—Å–ª–∞–≤ –û', '–ì –ö—Å–µ–Ω–∏—è –ê'];

        const SUBJECTS_DATA = {
            geo: {
                name: '–ì–µ–æ–≥—Ä–∞—Ñ–∏—è',
                people: [
                    '–ê –ê–ª—å—Ñ–∏–Ω–∞ –ê.', '–ê –ú–∏–ª–∞–Ω–∞ –ê', '–ê –ï–≤–∞ –≠', '–ê –ê–ª–µ–∫—Å–µ–π –ê', '–ë –î–º–∏—Ç—Ä–∏–π –î',
                    '–í –ú–∏—Ä—Ä–∞ –ü', '–ì –Ø—Ä–æ—Å–ª–∞–≤ –û', '–ì –ö—Å–µ–Ω–∏—è –ê', '–î –ò–≤–∞–Ω –î', '–î –ù–∞–¥–µ–∂–¥–∞ –ò',
                    '–ñ –õ–∞–≤—Ä–µ–Ω—Ç–∏–π –ê', '–ó –í–∞–ª–µ—Ä–∏—è –ê', '–ö –ê–Ω–¥—Ä–µ–π –ù', '–§–∏–ª–∏–ø –û. –ö', '–ö –Ø—Ä–æ—Å–ª–∞–≤ –î',
                    '–ü –î–∞—Ä—å—è –ò', '–ú –ê–Ω–∞—Å—Ç–∞—Å–∏—è –°', '–û –ü–∞–≤–µ–ª –ò', '–° –ê–ª–µ–∫—Å–∞–Ω–¥—Ä –Æ', '–° –î–∞–Ω–∏–∏–ª –°',
                    '–° –†–æ–º–∞–Ω –°', '–° –§–µ–¥–æ—Ä –ú', '–Æ –î–∞—Ä—å—è –ò', '–Ø –ú–∞—Ç–≤–µ–π –í'
                ],
                fixedPairs: [FIXED_PAIR]
            }
        };

        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function divideIntoTeamsWithPairs(people, teamsCount, fixedPairs) {
            const peopleSet = new Set(people);
            const teams = Array.from({ length: teamsCount }, () => []);
            const remaining = [...people];

            for (const pair of fixedPairs) {
                const [a, b] = pair;
                if (peopleSet.has(a) && peopleSet.has(b)) {
                    const minTeamIdx = teams.reduce((minIdx, team, idx) =>
                        team.length < teams[minIdx].length ? idx : minIdx, 0);
                    teams[minTeamIdx].push(a, b);
                    const aIndex = remaining.indexOf(a);
                    const bIndex = remaining.indexOf(b);
                    if (aIndex !== -1) remaining.splice(aIndex, 1);
                    if (bIndex !== -1) remaining.splice(bIndex - (aIndex < bIndex ? 1 : 0), 1);
                }
            }

            const shuffledRemaining = shuffle(remaining);
            shuffledRemaining.forEach(person => {
                const minTeamIdx = teams.reduce((minIdx, team, idx) =>
                    team.length < teams[minIdx].length ? idx : minIdx, 0);
                teams[minTeamIdx].push(person);
            });

            return teams;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = `‚ö†Ô∏è –û—à–∏–±–∫–∞: ${message}`;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function renderTeams(teams, subjectName) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h2>‚úÖ –ö–æ–º–∞–Ω–¥—ã –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É: <em>${subjectName}</em></h2>
                ${teams.map((team, i) => `
                    <div class="team">
                        <strong>üîπ –ö–æ–º–∞–Ω–¥–∞ ${i + 1} (${team.length}):</strong><br>
                        ${team.join(', ')}
                    </div>
                `).join('')}
            `;
        }

        function updatePeopleInfo() {
            const subjectKey = document.getElementById('subject').value;
            const subject = SUBJECTS_DATA[subjectKey];
            const infoBox = document.getElementById('peopleInfo');
            infoBox.innerHTML = `
                <span class="subject-title">${subject.name}:</span>
                ${subject.people.join(', ')}
            `;
        }

        document.getElementById('subject').addEventListener('change', updatePeopleInfo);

        document.getElementById('teamForm').addEventListener('submit', function(e) {
            e.preventDefault();
            hideError();

            const subjectKey = document.getElementById('subject').value;
            let teamsCount = parseInt(document.getElementById('teams_count').value);
            const absentInput = document.getElementById('absent').value.trim();

            if (isNaN(teamsCount) || teamsCount < 1) {
                showError('–ß–∏—Å–ª–æ –∫–æ–º–∞–Ω–¥ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ü–µ–ª—ã–º ‚â• 1');
                return;
            }

            const subject = SUBJECTS_DATA[subjectKey];
            if (!subject) {
                showError('–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç');
                return;
            }

            const allPeople = subject.people;
            const absentList = absentInput ?
                absentInput.split(',').map(s => s.trim()).filter(s => s) : [];

            const available = allPeople.filter(p => !absentList.includes(p));

            if (available.length === 0) {
                showError('–ù–µ–∫–æ–≥–æ –¥–µ–ª–∏—Ç—å ‚Äî –≤—Å–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.');
                return;
            }

            if (teamsCount > available.length) {
                showError(`–ù–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å ${teamsCount} –∫–æ–º–∞–Ω–¥ –∏–∑ ${available.length} —á–µ–ª–æ–≤–µ–∫.`);
                return;
            }

            try {
                const teams = divideIntoTeamsWithPairs(available, teamsCount, subject.fixedPairs);
                renderTeams(teams, subject.name);
            } catch (err) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥: ' + err.message);
            }
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updatePeopleInfo();
    </script>
</body>
</html>